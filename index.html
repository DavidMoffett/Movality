const VelocimoveEngine = {
    version: "42.0",
    currentPhase: 1,
    evidenceCount: 0,
    metrics: { latency: 0.02, swirl: 0, velocity: 1.2 },
    phases: [
        "Strategic Intent", "Logic Synthesis", "The Logic Gate", 
        "R-A-I Assignment", "Action Ledger", "Velocity Audit", 
        "Succession Loop", "Executive Resolution"
    ],

    init() {
        this.renderPhases();
        this.startEngine();
    },

    // The Drive Mechanism: Forces the engine through the 8 phases
    advance() {
        if (this.currentPhase < 8) {
            this.currentPhase++;
            this.addEvidence(`SYS-PHASE-${this.currentPhase}`, "PHASE_TRANSITION_SUCCESS");
            this.renderPhases();
            
            if (this.currentPhase === 8) {
                this.triggerExecutiveResolution();
            }
        }
    },

    calculateDrag() {
        return ((this.metrics.latency + this.metrics.swirl) / this.metrics.velocity).toFixed(2);
    },

    triggerExecutiveResolution() {
        const cd = this.calculateDrag();
        document.getElementById('velocity-status').innerHTML = 
            `<span style="color:var(--gold)">MISSION COMPLETE. CEO SEAL AFFIXED. Cd: ${cd}</span>`;
        this.addEvidence("CEO-SEAL-LOCK", "PERMANENT_ARCHIVE_GENERATED");
    },

    // Visual Rendering
    renderPhases() {
        const stack = document.getElementById('phase-list');
        stack.innerHTML = this.phases.map((p, i) => {
            let statusClass = "";
            if (i + 1 < this.currentPhase) statusClass = "complete";
            else if (i + 1 === this.currentPhase) statusClass = "active";
            
            return `<div class="phase ${statusClass}">
                ${(i + 1).toString().padStart(2, '0')} ${p.toUpperCase()}
                ${statusClass === 'complete' ? ' <span style="float:right">âœ“</span>' : ''}
            </div>`;
        }).join('');
    },

    addEvidence(id, type) {
        const log = document.getElementById('ledger-stream');
        log.innerHTML = `<div class="evidence-line"><span class="id-tag">${id}</span> | ${type}</div>` + log.innerHTML;
        this.evidenceCount++;
        
        // Internal Logic: Advance phase every 3 Evidence IDs
        if (this.evidenceCount % 3 === 0) this.advance();
    },

    startEngine() {
        setInterval(() => {
            const cd = this.calculateDrag();
            document.getElementById('drag-gauge').innerText = cd;
            
            if (this.currentPhase < 8) {
                this.addEvidence(`EV-${Math.floor(Math.random()*999)}`, "TELEMETRY_DATA_POINT");
            }
        }, 2000);
    }
};

window.onload = () => VelocimoveEngine.init();
